var autocomplete={v:'1.5',zidx:1975,querylength:15,delaytime:100,typedict:{'1':"address",'2':"menu",},dsplrule:{'1':function(str){return "<b>"+str.streetName+"</b>"+" "+str.city+" ("+str.zipCode+")";},'2':function(str){return "<b>"+str.name+"</b>";},},fullrule:{'1':function(str){return str.streetName;},'2':function(str){return str.name;},},uh:undefined,CB:undefined,add:function(obj,typeid,poolids,VX){if(!typeid)return;if(!poolids||poolids=='')poolids=[];if(! !poolids&&typeof(poolids)!='object')poolids=[poolids];autocomplete.mU();obj.each(function(){$(this).attr('typeid',typeid);$(this).attr('poolids',JSON.stringify(poolids));autocomplete.Ut($(this),VX);});},aak:function(obj,an){clearTimeout(autocomplete.uh);autocomplete.uh=window.setTimeout(function(){autocomplete.ahV(obj,an);},autocomplete.delaytime);},Ut:function(obj,an){obj.data('val',obj.val());obj.change(function(){autocomplete.aak($(this),an);});obj.keyup(function(){var val=obj.val();var LM=obj.data('val');if(val!=LM){obj.data('diff',autocomplete.ZI(LM,val));obj.data('val',val);$(this).change();}});},mU:function(){if(typeof(bK)=='undefined'|| !bK.isLocaltest)var ea=autocomplete.Er();else var ea=bK.serverAddr;autocomplete.CB=ea+'/kpos/webapp/search/';},ahV:function(obj,an){if(!autocomplete.CB)return;var ad=obj.data('diff');autocomplete.rmvabox(obj);if(ad=='')return;var type=obj.attr("typeid");var Jq=JSON.parse(obj.attr("poolids"));var ea=autocomplete.CB+autocomplete.typedict[type];var Ax=[];Ax.push('name='+ad);for(var i in Jq){Ax.push('type='+Jq[i]);}var Am=ea+"?"+Ax.join('&');autocomplete.acu(Am,function(kC){autocomplete.ahu(obj,kC,an,type);},function(kC){alert(JSON.stringify(kC));});},Er:function(){var jp=window.location.href.split('/');var BJ='';var vL=false;for(var i in jp){if(jp[i]=='http:')continue;else if(jp[i]=='https:'){vL=true;continue;}else if(jp[i]=='')continue;else{return(vL?"https://":"http://")+jp[i]+BJ;}}},acu:function(ea,acq,onerror){$.get(ea,function(data){acq(data);});},ahu:function(obj,list,an,type){if(list.length==0){return;}var cC=autocomplete.Xq(obj,autocomplete.typedict[type]=='address');var str='';for(var i in list){if(i>=autocomplete.querylength)break;cC.append(autocomplete.afJ(list[i],obj,i%2,an,type));}},afJ:function(str,obj,aay,an,type){var line=$("<div/>",{'class':'autocpltline'+(aay?" autocpltlinedk":'')});line.data('str',JSON.stringify(str));var strline=autocomplete.dsplrule[type](str);line.html(strline);line.click(function(){autocomplete.ZU(obj,$(this),an,type);});return line;},ZU:function(obj,line,an,type){var val=obj.val();var diff=obj.data('diff');var str=JSON.parse(line.data('str'));var name=autocomplete.fullrule[type](str);var opst=obj.getCursorPosition();var n=opst-diff.length+name.length+1;var l=val.substr(0,opst).split(" ");var b=val.substr(opst);l[l.length-1]=name;obj.val(l.join(' ')+' '+b);obj.data("val",obj.val());obj.selectRange(n);if(! !an)an(str,obj,n);line.parent().remove();event.stopPropagation();obj.focus();},objid:'autocpltbx',rmvabox:function(obj){$("#"+autocomplete.objid).remove();if(obj.is("textarea")){try{obj.textareaHelper("destroy");}catch(e){};}$(window).unbind("click",autocomplete.rmvabox);},Xq:function(obj,isaddr){var GL=$("body");var cC=$("<div/>",{'id':autocomplete.objid,'class':'autocpltbx'});GL.append(cC);cC.css({'z-index':autocomplete.zidx});var offset=obj.offset();if(obj.is("textarea")){var p=obj.textareaHelper('caretPos');cC.css({top:(p.top+offset.top+22),left:(p.left+offset.left+2)});}else{var acW=obj.height();cC.css({top:offset.top+acW+3,left:offset.left,width:obj.width()});var Ie=cC.height();if((cC.offset().top+Ie)>$(document).height())cC.css({top:offset.top-Ie});}$(window).click(function(){autocomplete.rmvabox(obj);});return cC;},ZI:function(s1,s2){var Sb=s1.split(" ");var pN=s2.split(" ");if(Sb.length>pN.length)return pN[pN.length-1];for(var i=pN.length-1;i>=0;i--){if(pN[i]!=Sb[i])return pN[i];}return '';},};(function($){'use strict';var caretClass='textarea-helper-caret',dataKey='textarea-helper',mirrorStyles=['box-sizing','height','width','padding-bottom','padding-left','padding-right','padding-top','font-family','font-size','font-style','font-variant','font-weight','word-spacing','letter-spacing','line-height','text-decoration','text-indent','text-transform','direction'];var TextareaHelper=function(elem){if(elem.nodeName.toLowerCase()!=='textarea')return;this.$text=$(elem);this.$mirror=$('<div/>').css({'position':'absolute','overflow':'auto','white-space':'pre-wrap','word-wrap':'break-word','top':0,'left': -9999}).insertAfter(this.$text);};(function(){this.update=function(){var styles={};for(var i=0,style;style=mirrorStyles[i];i++){styles[style]=this.$text.css(style);}this.$mirror.css(styles).empty();var caretPos=this.getOriginalCaretPos(),str=this.$text.val(),pre=document.createTextNode(str.substring(0,caretPos)),post=document.createTextNode(str.substring(caretPos)),$car=$('<span/>').addClass(caretClass).css('position','absolute').html('&nbsp;');this.$mirror.append(pre,$car,post).scrollTop(this.$text.scrollTop());};this.destroy=function(){this.$mirror.remove();this.$text.removeData(dataKey);return null;};this.caretPos=function(){this.update();var $caret=this.$mirror.find('.'+caretClass),pos=$caret.position();if(this.$text.css('direction')==='rtl'){pos.right=this.$mirror.innerWidth()-pos.left-$caret.width();pos.left='auto';}return pos;};this.height=function(){this.update();this.$mirror.css('height','');return this.$mirror.height();};this.getOriginalCaretPos=function(){var text=this.$text[0];if(text.selectionStart){return text.selectionStart;}else if(document.selection){text.focus();var r=document.selection.createRange();if(r==null){return 0;}var re=text.createTextRange(),rc=re.duplicate();re.moveToBookmark(r.getBookmark());rc.setEndPoint('EndToStart',re);return rc.text.length;}return 0;};}).call(TextareaHelper.prototype);$.fn.textareaHelper=function(method){this.each(function(){var $this=$(this),instance=$this.data(dataKey);if(!instance){instance=new TextareaHelper(this);$this.data(dataKey,instance);}});if(method){var instance=this.first().data(dataKey);return instance[method]();}else{return this;}};$.fn.selectRange=function(start,end){if(!end)end=start;return this.each(function(){if(this.setSelectionRange){this.focus();this.setSelectionRange(start,end);}else if(this.createTextRange){var range=this.createTextRange();range.collapse(true);range.moveEnd('character',end);range.moveStart('character',start);range.select();}});};$.fn.getCursorPosition=function(){var el=$(this).get(0);var pos=0;if('selectionStart'in el){pos=el.selectionStart;}else if('selection'in document){el.focus();var Sel=document.selection.createRange();var SelLength=document.selection.createRange().text.length;Sel.moveStart('character',-el.value.length);pos=Sel.text.length-SelLength;}return pos;};})(jQuery); 